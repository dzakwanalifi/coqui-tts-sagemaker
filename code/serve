#!/usr/bin/env python3

import os
import subprocess
import sys

# SageMaker serving script
if __name__ == '__main__':
    # Change to the code directory
    os.chdir('/opt/program')

    # Start Gunicorn with our Flask app
    cmd = [
        'gunicorn',
        '--timeout', '600',
        '-b', '0.0.0.0:8080',
        '--workers', '1',
        '--threads', '1',
        'inference:app'
    ]

    print('Starting Gunicorn server...')
    print(f'Command: {\" \".join(cmd)}')

    # Execute the command
    result = subprocess.run(cmd)
    sys.exit(result.returncode)